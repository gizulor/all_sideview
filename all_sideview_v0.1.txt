# Type: Admin/AJAX plugin
# Write tab with live site view
# Author: Gary Venter
# URL: https://all-sorts.biz
# Recommended load order: 4

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJhbGxfc2lkZXZpZXciO3M6NjoiYXV0aG9yIjtzOjEx
OiJHYXJ5IFZlbnRlciI7czoxMDoiYXV0aG9yX3VyaSI7czoyMToiaHR0cHM6Ly9hbGwtc29y
dHMuYml6IjtzOjc6InZlcnNpb24iO3M6MzoiMC4xIjtzOjExOiJkZXNjcmlwdGlvbiI7czoy
OToiV3JpdGUgdGFiIHdpdGggbGl2ZSBzaXRlIHZpZXciO3M6NDoiY29kZSI7czozNTc5OiJp
ZiAodHhwaW50ZXJmYWNlID09PSAnYWRtaW4nKSB7DQogICAgcmVnaXN0ZXJfY2FsbGJhY2so
J2FsbF9zaWRldmlld19jc3MnLCAnYWRtaW5fc2lkZScsICdoZWFkX2VuZCcpOw0KICAgIHJl
Z2lzdGVyX2NhbGxiYWNrKCdhbGxfc2lkZXZpZXdfanMnLCAnYWRtaW5fc2lkZScsICdoZWFk
X2VuZCcpOw0KfQ0KDQpmdW5jdGlvbiBhbGxfc2lkZXZpZXdfY3NzKCkgew0KICAkcGx1Z2lu
X2NzcyA9IDw8PEVPQ1NTDQogICAgYm9keTpoYXMoI3NpZGV2aWV3KSB7DQogICAgICBwYWRk
aW5nLWlubGluZTogMmVtOw0KICAgIH0NCg0KICAgIC50eHAtYm9keTpoYXMoI3NpZGV2aWV3
KSB7DQogICAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgICBkaXNwbGF5OiBncmlkOw0KICAg
ICAgZ2FwOiBjbGFtcCgxZW0sIDQlLCA0cmVtKTsNCiAgICAgIGdyaWQtdGVtcGxhdGUtY29s
dW1uczogbWlubWF4KDcyMHB4LCAxMjgwcHgpIG1pbm1heCgzNjBweCwgMTI4MHB4KTsNCiAg
ICB9DQoNCiAgICAjc2lkZXZpZXcgew0KICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgd2lk
dGg6IDEwMCU7DQogICAgICByZXNpemU6IGJvdGg7DQogICAgICBvdmVyZmxvdzogYXV0bzsN
CiAgICAgIGJvcmRlcjogMDsNCiAgICAgIG91dGxpbmU6IDFweCBzb2xpZCB2YXIoLS1jbHIt
YnJkcik7DQogICAgfQ0KDQogICAgLnNpZGV2aWV3X19idXR0b24gew0KICAgICAgLnVpLWlj
b246bGFzdC1vZi10eXBlIHsNCiAgICAgICAgbWFyZ2luLWxlZnQ6IC0uMTI1ZW07DQogICAg
ICAgIHRyYW5zZm9ybTogcm90YXRlWigwKTsNCiAgICAgICAgbWFyZ2luLXJpZ2h0OiAuMzc1
ZW07DQogICAgICB9DQogICAgfQ0KDQogICAgLnNpZGV2aWV3LS1hY3RpdmUsDQogICAgLnR4
cC1ib2R5Omhhcygjc2lkZXZpZXcpIC5zaWRldmlld19fYnV0dG9uIHsNCiAgICAgIC51aS1p
Y29uOmxhc3Qtb2YtdHlwZSB7DQogICAgICAgIHRyYW5zZm9ybTogcm90YXRlWigxODBkZWcp
Ow0KICAgICAgfQ0KICAgIH0NCiAgRU9DU1M7DQoNCiAgaWYgKGNsYXNzX2V4aXN0cygnXFRl
eHRwYXR0ZXJuXFVJXFN0eWxlJykpIHsNCiAgICBlY2hvIFR4cDo6Z2V0KCdcVGV4dHBhdHRl
cm5cVUlcU3R5bGUnKS0+c2V0Q29udGVudCgkcGx1Z2luX2Nzcyk7DQogIH0gZWxzZSB7DQog
ICAgZWNobyAnPHN0eWxlPicgLiAkcGx1Z2luX2NzcyAuICc8L3N0eWxlPic7DQogIH0NCn0N
Cg0KZnVuY3Rpb24gYWxsX3NpZGV2aWV3X2pzKCkgew0KICAkcGx1Z2luX2pzID0gPDw8RU9K
Uw0KICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgew0KICAgICAgaWYoJCh3aW5k
b3cpLndpZHRoKCkgPCAxMjgwKSB7DQogICAgICAgIGV4aXQ7DQogICAgICB9DQoNCiAgICAg
IGlmICgkKCcjcGFnZS1hcnRpY2xlJykubGVuZ3RoKSB7DQogICAgICAgICAgICBjb25zdCBz
ZWN0aW9uRXhjbHVkZWQgPSAnJzsNCiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb25TZWxlY3Qg
PSAkKCcjc2VjdGlvbicpWzBdOw0KDQogICAgICAgICAgICBjb25zdCBhcnRpY2xlU2VjdGlv
biA9IHNlY3Rpb25TZWxlY3QudmFsdWU7DQogICAgICAgICAgICB2YXIgY3VycmVudFVybCA9
ICQoJyNhcnRpY2xlX3BhcnRpYWxfYXJ0aWNsZV92aWV3JykuYXR0cignaHJlZicpOw0KDQog
ICAgICAgICAgICBpZiAoYXJ0aWNsZVNlY3Rpb24gIT0gc2VjdGlvbkV4Y2x1ZGVkICYmIGN1
cnJlbnRVcmwpIHsNCiAgICAgICAgICAgICAgc2lkZVZpZXcoKTsNCiAgICAgICAgICAgIH0g
ZWxzZSB7DQogICAgICAgICAgICAgICQoJyNzaWRldmlldycpLnJlbW92ZSgpOw0KICAgICAg
ICAgICAgfQ0KDQogICAgICAgICAgICAkKCJmb3JtIikub24oImNoYW5nZSIsIGZ1bmN0aW9u
KCkgew0KICAgICAgICAgICAgICBzaWRlVmlld1JlbG9hZElmcmFtZSgpOw0KICAgICAgICAg
ICAgfSk7DQoNCiAgICAgICAgICAgIGlmIChjdXJyZW50VXJsKSB7DQogICAgICAgICAgICAg
IHNpZGVWaWV3QXBwZW5kQnRuKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRl
eHRwYXR0ZXJuLlJlbGF5LnJlZ2lzdGVyKCJ0eHBBc3luY0Zvcm0uc3VjY2VzcyIsIHNpZGVW
aWV3QXBwZW5kQnRuKTsNCiAgICAgICAgICAgIHRleHRwYXR0ZXJuLlJlbGF5LnJlZ2lzdGVy
KCJ0eHBBc3luY0Zvcm0uc3VjY2VzcyIsIHNpZGVWaWV3UmVsb2FkSWZyYW1lKTsNCiAgICAg
IH0NCg0KICAgICAgZnVuY3Rpb24gc2lkZVZpZXdBcHBlbmRCdG4oKSB7DQogICAgICAgICQo
Jy50eHAtc2F2ZS16b25lIC50eHAtYWN0aW9ucycpLmFwcGVuZCgnPGEgaHJlZj0iIiB0aXRs
ZT0iVmlldyBhcnRpY2xlIGFsb25nc2lkZSIgY2xhc3M9InNpZGV2aWV3X19idXR0b24iPjxz
cGFuIGNsYXNzPSJ1aS1pY29uIHVpLWljb24tbm90aWNlIj48L3NwYW4+IDxzcGFuIGNsYXNz
PSJ1aS1pY29uIHVpLWljb24tY29weSI+PC9zcGFuPlNpZGV2aWV3PC9hPicpOw0KICAgICAg
ICAkKCcuc2lkZXZpZXdfX2J1dHRvbicpLmNsaWNrKGZ1bmN0aW9uKCkgew0KICAgICAgICAg
IGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2lkZVZpZXcnKSAhPSAndHJ1ZScpIHsNCiAg
ICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzaWRlVmlldycsICd0cnVlJyk7DQog
ICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdzaWRldmlldy0tYWN0aXZlJyk7DQogICAg
ICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzaWRl
VmlldycsICdmYWxzZScpOw0KICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnc2lk
ZXZpZXctLWFjdGl2ZScpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBzaWRlVmlldygpOw0K
ICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAg
IGZ1bmN0aW9uIHNpZGVWaWV3UmVsb2FkSWZyYW1lKCkgew0KICAgICAgICAgIGlmICgkKCcj
c2lkZXZpZXcnKS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVt
ZW50QnlJZCgnc2lkZXZpZXcnKS5jb250ZW50RG9jdW1lbnQubG9jYXRpb24ucmVsb2FkKHRy
dWUpOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmb3JtIGNoYW5nZWQnKTsNCiAg
ICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNpZGVWaWV3KCkgew0KICAg
ICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NpZGVWaWV3JykgPT0gJ3RydWUnKSB7
DQogICAgICAgICAgJCgnLnR4cC1ib2R5JykuYXBwZW5kKCc8aWZyYW1lIGlkPSJzaWRldmll
dyIgc3JjPSInICsgY3VycmVudFVybCArICciPjwvaWZyYW1lPicpOw0KICAgICAgICB9IGVs
c2Ugew0KICAgICAgICAgICQoJyNzaWRldmlldycpLnJlbW92ZSgpOw0KICAgICAgICB9DQog
ICAgICB9DQoNCiAgICB9KTsNCkVPSlM7DQoNCiAgICBpZiAoY2xhc3NfZXhpc3RzKCdcVGV4
dHBhdHRlcm5cVUlcU2NyaXB0JykpIHsNCiAgICAgICAgZWNobyBUeHA6OmdldCgnXFRleHRw
YXR0ZXJuXFVJXFNjcmlwdCcpLT5zZXRDb250ZW50KCRwbHVnaW5fanMpOw0KICAgIH0gZWxz
ZSB7DQogICAgICAgIGVjaG8gJzxzY3JpcHQ+JyAuICRwbHVnaW5fanMgLiAnPC9zY3JpcHQ+
JzsNCiAgICB9DQp9DQoiO3M6NDoidHlwZSI7czoxOiI0IjtzOjU6Im9yZGVyIjtzOjE6IjQi
O3M6NToiZmxhZ3MiO3M6MToiMCI7czo0OiJoZWxwIjtzOjUwMDoiPHA+PHN0cm9uZz5hbGxf
c2lkZXZpZXc8L3N0cm9uZz4gYWRkcyBhIHRvZ2dsZSB3aGljaCBkaXNwbGF5cyB0aGUgcHVi
bGljIHZpZXcgb2YgdGhlIGN1cnJlbnQgYXJ0aWNsZS48L3A+Cgo8cD5TaWRldmlldyBkaXNw
bGF5cyBpZiB5b3VyIHNjcmVlbiBpcyBsYXJnZSBlbm91Z2gsIGFuZCB1cGRhdGVzIGV2ZXJ5
IHRpbWUgeW91IHNhdmUgeW91ciBhcnRpY2xlLiA8YnIgLz4KSWYgeW91IHdhbnQgdG8gZXhj
bHVkZSBhIHNlY3Rpb24gZnJvbSBTaWRldmlldywgc3BlY2lmeSBpdCBhdCB0aGUgYmVnaW5u
aW5nIG9mIHRoZSBKYXZhc2NyaXB0IGJsb2NrIChhcm91bmQgbGluZSA2MCk6IDxjb2RlPmNv
bnN0IHNlY3Rpb25FeGNsdWRlZCA9ICYjMzk7eW91cnNlY3Rpb25uYW1lJiMzOTs8L2NvZGU+
LjwvcD4KCjxwPlRoYW5rcyB0byA8c3Ryb25nPmpha29iPC9zdHJvbmc+IHdobyBkaWQgdGhl
IGhlYXZ5IGxpZnRpbmcgaW4gY29udmVydGluZyBteSBjb2RlIHRvIGEgcGx1Z2luLjwvcD4i
O3M6MzoibWQ1IjtzOjMyOiI1NmUyZWQxYWNjODIyYzkxNzkwZmY3NTJjZjljZDJkNiI7fQ==
